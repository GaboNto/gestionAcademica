generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ------------------------- Enums -------------------------

enum EstadoPractica {
  EN_CURSO   @map("En Curso")
  APROBADO   @map("Aprobado")
  REPROBADO  @map("Reprobado")
}

enum EstadoActividad {
  PENDIENTE
  APROBADA
  OBSERVADA
}

enum TipoCentro {
  PARTICULAR
  PARTICULAR_SUBVENCIONADO @map("PARTICULAR SUBVENCIONADO")
  SLEP
  NO_CONVENCIONAL
}

// Rol contextual del tutor en la prÃ¡ctica (pivote)
enum TipoTutor {
  Supervisor
  Tallerista
}

// ------------------------- Estudiante -------------------------
model Estudiante {
  rut                  String    @id
  nombre               String
  genero               String?
  anio_nacimiento      DateTime?
  anio_ingreso         Int?
  plan                 String?
  avance               Float?
  puntaje_ponderado    Float?
  puntaje_psu          Float?
  promedio             Float?
  fono                 Int?
  email                String?
  direccion            String?
  sistema_ingreso      String?
  numero_inscripciones Int?

  practicas Practica[]

  @@map("estudiante")
}

// ------------------------- Practica -------------------------
model Practica {
  id            Int             @id @default(autoincrement())
  estado        EstadoPractica
  fecha_inicio  DateTime
  fecha_termino DateTime?
  tipo          String?

  // N:1 â†’ Estudiante
  estudianteRut String
  estudiante    Estudiante      @relation(fields: [estudianteRut], references: [rut])

  // N:1 â†’ CentroEducativo
  centroId Int
  centro   CentroEducativo      @relation(fields: [centroId], references: [id])

  // 1:N â†’ Actividad
  actividades Actividad[]

  // M:N explÃ­citas
  practicaColaboradores PracticaColaborador[]
  practicaTutores       PracticaTutor[]

  @@map("practica")
}

// ------------------------- CentroEducativo -------------------------
model CentroEducativo {
  id                      Int         @id @default(autoincrement())
  nombre                  String
  region                  String?
  comuna                  String?
  direccion               String?
  telefono                Int?
  correo                  String?
  tipo                    TipoCentro?
  convenio                String?
  url_rrss                String?
  fecha_inicio_asociacion DateTime?

  practicas    Practica[]
  trabajadores TrabajadorEduc[]

  @@map("centro_educativo")
}

// ------------------------- TrabajadorEduc -------------------------
model TrabajadorEduc {
  id       Int     @id @default(autoincrement())
  rut      String  @unique
  nombre   String
  rol      String?
  correo   String?
  telefono Int?

  centroId Int
  centro   CentroEducativo @relation(fields: [centroId], references: [id], onDelete: Cascade)

  @@map("trabajador_educ")
}

// ------------------------- Colaborador -------------------------
model Colaborador {
  id                 Int      @id @default(autoincrement())
  rut                String   @unique
  nombre             String
  correo             String?
  direccion          String?
  telefono           Int?
  universidad_egreso String?

  encuestas EncuestaColaborador[]
  cargos    Cargo[]

  // M:N explÃ­cita â†’ PrÃ¡ctica (pivote)
  practicaColaboradores PracticaColaborador[]

  @@map("colaborador")
}

// ------------------------- Actividad -------------------------
model Actividad {
  id             Int      @id @default(autoincrement())
  titulo         String
  descripcion    String?
  estado         EstadoActividad
  fecha_registro DateTime @default(now())
  evidencia      String?
  rut            String?

  practicaId Int
  practica   Practica @relation(fields: [practicaId], references: [id])

  @@map("actividad")
}

// ------------------------- Usuario -------------------------
model Usuario {
  id         Int    @id @default(autoincrement())
  nombre     String
  correo     String @unique
  rol        String
  contrasena String

  @@map("usuario")
}

// ------------------------- Encuestas / Preguntas -------------------------
model Pregunta {
  id                   Int                           @id @default(autoincrement())
  descripcion          String
  alternativas         Alternativa[]
  encuestasEstudiante  EncuestaEstudiantePregunta[]
  encuestasColaborador EncuestaColaboradorPregunta[]

  @@map("pregunta")
}

model Alternativa {
  id          Int     @id @default(autoincrement())
  descripcion String
  puntaje     Int

  preguntaId Int
  pregunta   Pregunta @relation(fields: [preguntaId], references: [id])

  @@map("alternativa")
}

model EncuestaEstudiante {
  id                 Int       @id @default(autoincrement())
  id_encuesta        String?   @unique
  nombre_estudiante  String?
  nombre_tallerista  String?
  nombre_centro      String?
  nombre_colaborador String?
  nivel_practica     String?
  fecha              DateTime?
  observacion        String?

  preguntas EncuestaEstudiantePregunta[]

  @@map("encuesta_estudiante")
}

model EncuestaColaborador {
  id                 Int      @id @default(autoincrement())
  nombre_colaborador String?
  nombre_colegio     String?
  sugerencias        String?
  cumple_perfil      Boolean?
  evaluacion         Int?

  colaboradorId Int?
  colaborador   Colaborador? @relation(fields: [colaboradorId], references: [id])

  preguntas EncuestaColaboradorPregunta[]

  @@map("encuesta_colaborador")
}

model EncuestaEstudiantePregunta {
  encuestaId Int
  preguntaId Int

  encuesta EncuestaEstudiante @relation(fields: [encuestaId], references: [id])
  pregunta Pregunta           @relation(fields: [preguntaId], references: [id])

  @@id([encuestaId, preguntaId])
  @@map("enc_est_preg")
}

model EncuestaColaboradorPregunta {
  encuestaId Int
  preguntaId Int

  encuesta EncuestaColaborador @relation(fields: [encuestaId], references: [id])
  pregunta Pregunta            @relation(fields: [preguntaId], references: [id])

  @@id([encuestaId, preguntaId])
  @@map("enc_colab_preg")
}

// ------------------------- Tutor -------------------------
model Tutor {
  id                 Int     @id @default(autoincrement())
  rut                String  @unique
  nombre             String
  correo             String?
  direccion          String?
  telefono           Int?
  universidad_egreso String?

  cargos          Cargo[]
  practicaTutores PracticaTutor[]

  @@map("tutor")
}

// ------------------------- ðŸ“Œ CartaSolicitud -------------------------
model CartaSolicitud {
  id               Int      @id @default(autoincrement())
  numero_folio     String   @unique
  fecha            DateTime
  direccion_emisor String?
  url_archivo      String?

  @@map("carta_solicitud")
}

// ---------------------- Pivotes M:N limpios ----------------------
model PracticaColaborador {
  practicaId    Int
  colaboradorId Int

  practica    Practica    @relation(fields: [practicaId], references: [id], onDelete: Cascade)
  colaborador Colaborador @relation(fields: [colaboradorId], references: [id], onDelete: Cascade)

  @@id([practicaId, colaboradorId])
  @@map("practica_colaborador")
}

model PracticaTutor {
  practicaId Int
  tutorId    Int

  // Rol contextual del tutor en ESTA prÃ¡ctica
  rol        TipoTutor

  practica Practica @relation(fields: [practicaId], references: [id], onDelete: Cascade)
  tutor    Tutor    @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  @@id([practicaId, tutorId])
  @@map("practica_tutor")
}

// ------------------------- Cargo -------------------------
model Cargo {
  id    Int    @id @default(autoincrement())
  cargo String

  tutorId Int?
  tutor   Tutor?       @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  colaboradorId Int?
  colaborador   Colaborador? @relation(fields: [colaboradorId], references: [id], onDelete: Cascade)

  @@map("cargo")
}
