<div class="container section">
  <!-- HEADER -->
  <div class="header">
    <button mat-stroked-button color="primary" (click)="goBack()" class="btn-back">
      <mat-icon>arrow_back</mat-icon> Volver al Dashboard
    </button>

    <div class="headline">
      <h1>Gestión de Colaboradores</h1>
      <p class="muted">Filtra por nombre, email, colegio o rol</p>
    </div>

    <div class="spacer"></div>

    <!-- BOTÓN AGREGAR -->
    <button mat-flat-button color="primary" (click)="toggleForm()" class="btn-add">
      <mat-icon>{{ showForm ? 'close' : 'person_add' }}</mat-icon>
      {{ showForm ? 'Cerrar' : 'Agregar colaborador' }}
    </button>
  </div>

  <!-- FILTROS -->
  <mat-card class="elev">
    <mat-card-title>Filtros de Búsqueda</mat-card-title>
    <mat-card-content>
      <div class="filters">
        <mat-form-field appearance="outline" class="flex1">
          <mat-label>Nombre, email o colegio…</mat-label>
          <input matInput [(ngModel)]="searchTerm" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="role-filter">
          <mat-label>Rol</mat-label>
          <mat-select [(ngModel)]="selectedRole">
            <mat-option value="all">Todos</mat-option>
            <mat-option value="Supervisor">Supervisor</mat-option>
            <mat-option value="Colaborador">Colaborador</mat-option>
            <mat-option value="Tallerista">Tallerista</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- FORMULARIO (colapsable por botón) -->
  <mat-card class="elev form-card" *ngIf="showForm">
    <mat-card-header>
      <div mat-card-avatar class="avatar green">
        <mat-icon>person_add</mat-icon>
      </div>
      <mat-card-title>Agregar colaborador</mat-card-title>
      <mat-card-subtitle>Completa los datos mínimos para registrarlo</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>Nombre completo</mat-label>
          <input matInput [(ngModel)]="newColaborador.nombre" name="nombre" required />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput [(ngModel)]="newColaborador.email" name="email" type="email" required />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Teléfono</mat-label>
          <input matInput [(ngModel)]="newColaborador.telefono" name="telefono" placeholder="+56 9 ..." />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Centro educativo</mat-label>
          <input matInput [(ngModel)]="newColaborador.centro_educativo" name="centro" required />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Rol</mat-label>
          <mat-select [(ngModel)]="newColaborador.role" name="role" required>
            <mat-option value="Supervisor">Supervisor</mat-option>
            <mat-option value="Colaborador">Colaborador</mat-option>
            <mat-option value="Tallerista">Tallerista</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Especialidad</mat-label>
          <input matInput [(ngModel)]="newColaborador.especialidad" name="especialidad" placeholder="Historia, Lenguaje…" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Experiencia</mat-label>
          <input matInput [(ngModel)]="newColaborador.experiencia" name="experiencia" placeholder="5 años, 2 semestres…" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Estado</mat-label>
          <mat-select [(ngModel)]="newColaborador.estado" name="estado">
            <mat-option value="Activo">Activo</mat-option>
            <mat-option value="Inactivo">Inactivo</mat-option>
          </mat-select>
        </mat-form-field>
      </form>

      <div class="form-actions">
        <button mat-raised-button color="primary" (click)="addColaborador()">
          <mat-icon>save</mat-icon> Agregar colaborador
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- TARJETAS -->
  <div class="cards">
    <mat-card class="coll elev card-click" *ngFor="let c of filtered()">
      <mat-card-header>
        <div
          mat-card-avatar
          class="avatar"
          [ngClass]="c.role === 'Supervisor' ? 'blue' : c.role === 'Tallerista' ? 'teal' : 'purple'">
          <mat-icon>
            {{ c.role === 'Supervisor' ? 'supervisor_account' : c.role === 'Tallerista' ? 'handyman' : 'person' }}
          </mat-icon>
        </div>
        <mat-card-title>{{ c.nombre }}</mat-card-title>
        <mat-card-subtitle>{{ c.centro_educativo }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="badge" [ngClass]="statusClass(c.estado)">
          {{ c.estado }}
        </div>

        <div class="mt">
          <b>{{ c.role }}</b> · {{ c.especialidad || '—' }}
        </div>

        <div class="muted">Experiencia: {{ c.experiencia || '—' }}</div>
        <div class="muted"> {{ c.email }}</div>
        <div class="muted"> {{ c.telefono || '—' }}</div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-stroked-button color="primary">
          <mat-icon>edit</mat-icon> Editar
        </button>

        <button mat-stroked-button color="warn" (click)="remove(c)">
          <mat-icon>delete</mat-icon> Eliminar
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- EMPTY -->
  <mat-card *ngIf="!filtered().length" class="elev empty">
    <mat-card-content class="muted empty__content">
      <mat-icon>group_off</mat-icon>
      <p>No se encontraron colaboradores con los filtros seleccionados.</p>
    </mat-card-content>
  </mat-card>
</div>
