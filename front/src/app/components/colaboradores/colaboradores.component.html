<div class="Container Section">
  <!-- HEADER -->
  <div class="Header">
    
    <div class="Headline">
      <h1>Gestión de Colaboradores</h1>
      <p class="Muted">Gestión de Supervisores, Talleristas y Colaboradores</p>
    </div>

    <div class="Spacer"></div>

    <!-- BOTÓN AGREGAR -->
    <button mat-flat-button color="primary" (click)="alternarFormulario()" class="BtnAdd">
      <mat-icon>{{ mostrarFormulario ? 'close' : 'person_add' }}</mat-icon>
      {{ mostrarFormulario ? 'Cerrar' : 'Agregar colaborador' }}
    </button>
  </div>

  <!-- FILTROS DE BÚSQUEDA -->
  <mat-card class="FiltersCard Elev">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>search</mat-icon>
        Filtros de Búsqueda
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="FiltersGrid">
        <mat-form-field appearance="outline" class="SearchField">
          <mat-label>Buscar</mat-label>
          <input matInput [(ngModel)]="terminoBusqueda" (ngModelChange)="aplicarFiltros()" placeholder="Nombre, email o cargo..." />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="FilterField">
          <mat-label>Rol</mat-label>
        <mat-select [(ngModel)]="rolSeleccionado" (selectionChange)="aplicarFiltros()">
            <mat-option value="all">Todos los roles</mat-option>
          <mat-option value="TUTOR">Tutor</mat-option>
          <mat-option value="COLABORADOR">Colaborador</mat-option>
          <mat-option value="TALLERISTA">Tallerista</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- FORMULARIO (colapsable por botón) -->
  <div class="FormContainer" [class.FormOpen]="mostrarFormulario">
    @if (mostrarFormulario) {
      <mat-card class="Elev FormCard">
        <mat-card-header class="FormHeader">
          <div class="FormTitleSection">
            <div class="FormIcon">
              <mat-icon>{{ estaEditando ? 'edit' : 'person_add' }}</mat-icon>
            </div>
          <div class="FormTitles">
            <h2>{{ estaEditando ? 'Editar colaborador' : 'Agregar colaborador' }}</h2>
            <p>{{ estaEditando ? 'Modifica los datos del colaborador' : 'Completa los datos para registrar un nuevo colaborador' }}</p>
          </div>
          </div>
          <button mat-icon-button (click)="alternarFormulario()" class="CloseFormBtn">
            <mat-icon>close</mat-icon>
          </button>
        </mat-card-header>

        <mat-card-content class="FormContent">
          <form class="FormGrid">
            <div class="FormRow">
              <mat-form-field appearance="outline" class="FormField">
                <mat-label>Nombre completo</mat-label>
                <input matInput [(ngModel)]="nuevoColaborador.nombre" name="nombre" required />
              </mat-form-field>

              <mat-form-field appearance="outline" class="FormField">
                <mat-label>RUT</mat-label>
                <input matInput [(ngModel)]="nuevoColaborador.rut" name="rut" placeholder="12.345.678-9" />
              </mat-form-field>
            </div>

            <div class="FormRow">
              <mat-form-field appearance="outline" class="FormField">
                <mat-label>Email</mat-label>
                <input matInput [(ngModel)]="nuevoColaborador.correo" name="correo" type="email" />
              </mat-form-field>

              <mat-form-field appearance="outline" class="FormField">
                <mat-label>Teléfono</mat-label>
                <input matInput [(ngModel)]="nuevoColaborador.telefono" name="telefono" placeholder="987654321" type="number" />
              </mat-form-field>
            </div>

            <div class="FormRow">
              <mat-form-field appearance="outline" class="FormField FullWidth">
                <mat-label>Dirección</mat-label>
                <input matInput [(ngModel)]="nuevoColaborador.direccion" name="direccion" placeholder="Calle 123, Comuna, Región" />
              </mat-form-field>
            </div>

            <div class="FormRow">
              <mat-form-field appearance="outline" class="FormField">
                <mat-label>Rol</mat-label>
                <mat-select [(ngModel)]="nuevoColaborador.tipo" name="tipo">
                  <mat-option value="COLABORADOR">Colaborador</mat-option>
                  <mat-option value="TUTOR">Supervisor</mat-option>
                  <mat-option value="TALLERISTA">Tallerista</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="FormField">
                <mat-label>Cargo</mat-label>
                <input matInput [(ngModel)]="nuevoColaborador.cargo" name="cargo" placeholder="Profesor de Historia, Coordinador…" />
              </mat-form-field>
            </div>

            <div class="FormRow">
              <mat-form-field appearance="outline" class="FormField FullWidth">
                <mat-label>Universidad de egreso</mat-label>
                <input matInput [(ngModel)]="nuevoColaborador.universidad_egreso" name="universidad_egreso" placeholder="Universidad de Chile, PUC…" />
              </mat-form-field>
            </div>
          </form>

        <div class="FormActions">
          <button mat-stroked-button (click)="alternarFormulario()" class="CancelBtn">
            Cancelar
          </button>
          <button mat-raised-button color="primary" (click)="estaEditando ? actualizarColaborador() : agregarColaborador()" class="SubmitBtn">
            <mat-icon>{{ estaEditando ? 'save' : 'person_add' }}</mat-icon> 
            {{ estaEditando ? 'Guardar cambios' : 'Añadir' }}
          </button>
        </div>
        </mat-card-content>
      </mat-card>
    }
  </div>

  <!-- LISTADO DE COLABORADORES -->
  <mat-card class="Elev">
    <mat-card-content class="ListContainer">
      @if (cargando) {
        <div style="text-align: center; padding: 2rem;">
          <p class="Muted">Cargando colaboradores...</p>
        </div>
      } @else {
        @for (c of filtrados(); track c.id) {
        <div class="ListItem">
          <div class="ItemContent">
            <!-- Avatar y nombre -->
            <div class="ItemMain">
              <div class="ItemInfo">
                <h3>{{ c.nombre }}</h3>
                  <p class="Muted">{{ c.correo || 'Sin email' }}</p>
                </div>
            </div>

            <!-- Rol y cargo -->
            <div class="ItemRole">
                <strong>{{ c.tipo || 'Sin rol' }}</strong>
                @if (c.cargo) {
                  <span> · {{ c.cargo }}</span>
              }
            </div>

            <!-- Acciones -->
            <div class="ItemActions">
              <button mat-icon-button color="accent" (click)="verDetalles(c)" title="Ver más información">
                <mat-icon>visibility</mat-icon>
              </button>
            <button mat-icon-button color="primary" (click)="editarColaborador(c)" title="Editar">
              <mat-icon>edit</mat-icon>
            </button>
              <button mat-icon-button color="warn" (click)="eliminar(c)" title="Eliminar">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>
        }
      }
    </mat-card-content>
  </mat-card>

  <!-- EMPTY -->
  @if (!filtrados().length) {
    <mat-card class="Elev Empty">
      <mat-card-content class="Muted EmptyContent">
        <mat-icon>group_off</mat-icon>
        <p>No se encontraron colaboradores con los filtros seleccionados.</p>
      </mat-card-content>
    </mat-card>
  }

  <!-- DIALOGO DETALLES -->
  @if (colaboradorSeleccionado) {
    <div class="DetailsDialog">
      <div class="DialogOverlay" (click)="cerrarDetalles()"></div>
      <div class="DialogContent">
        <div class="DialogHeader">
          <h2>Información del Colaborador</h2>
          <button mat-icon-button (click)="cerrarDetalles()" class="CloseBtn">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <div class="DialogBody">
          <div class="DetailsGrid">
            <div class="DetailItem">
              <label>Nombre completo:</label>
              <span>{{ colaboradorSeleccionado.nombre }}</span>
            </div>
            
            <div class="DetailItem">
              <label>RUT:</label>
              <span>{{ colaboradorSeleccionado.rut || 'No especificado' }}</span>
            </div>
            
            <div class="DetailItem">
              <label>Email:</label>
              <span>{{ colaboradorSeleccionado.correo || 'No especificado' }}</span>
            </div>
            
            <div class="DetailItem">
              <label>Dirección:</label>
              <span>{{ colaboradorSeleccionado.direccion || 'No especificada' }}</span>
            </div>
            
            <div class="DetailItem">
              <label>Teléfono:</label>
              <span>{{ colaboradorSeleccionado.telefono || 'No especificado' }}</span>
            </div>
            
            <div class="DetailItem">
              <label>Rol:</label>
              <span>{{ colaboradorSeleccionado.tipo || 'No especificado' }}</span>
            </div>
            
            <div class="DetailItem">
              <label>Cargo:</label>
              <span>{{ colaboradorSeleccionado.cargo || 'No especificado' }}</span>
            </div>
            
            <div class="DetailItem">
              <label>Universidad de egreso:</label>
              <span>{{ colaboradorSeleccionado.universidad_egreso || 'No especificada' }}</span>
            </div>
          </div>
        </div>
        
        <div class="DialogActions">
          <button mat-stroked-button (click)="cerrarDetalles()">Cerrar</button>
        <button mat-raised-button color="primary" (click)="editarColaborador(colaboradorSeleccionado!)">
          <mat-icon>edit</mat-icon>
          Editar colaborador
        </button>
        </div>
      </div>
    </div>
  }

  <!-- MODAL DE CONFIRMACIÓN DE ELIMINACIÓN -->
  @if (mostrarConfirmarEliminar && colaboradorAEliminar) {
    <div class="DeleteConfirmDialog">
      <div class="DialogOverlay" (click)="cerrarConfirmarEliminar()"></div>
      <div class="DeleteDialogContent">
        <div class="DeleteDialogHeader">
          <div class="DeleteIcon">
            <mat-icon>warning</mat-icon>
          </div>
          <h2>Confirmar eliminación</h2>
        </div>
        
        <div class="DeleteDialogBody">
          <p>¿Estás seguro de que quieres eliminar a <strong>{{ colaboradorAEliminar.nombre }}</strong>?</p>
          <p class="WarningText">Esta acción no se puede deshacer.</p>
        </div>
        
        <div class="DeleteDialogActions">
          <button mat-stroked-button (click)="cerrarConfirmarEliminar()" class="CancelDeleteBtn">
            Cancelar
          </button>
          <button mat-raised-button color="warn" (click)="confirmarEliminar()" class="ConfirmDeleteBtn">
            <mat-icon>delete</mat-icon>
            Eliminar
          </button>
        </div>
      </div>
    </div>
  }
</div>